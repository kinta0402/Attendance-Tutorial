class SessionsController < ApplicationController

  def new
  end

  # ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç† (ä¸€è¦‹ã™ã‚‹ã¨createã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç‚ºã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã£ã½ã„ãŒã€ã“ã‚Œã¯session cntrollerå†…ï¼ï¼) 
  
  def create # æ³¨) ã“ã“ã¯sessionï¾’ï½¿ï½¯ï¾„ï¾žã§ã¯ãªãã€sessionã‚«ãƒ©ãƒ (ãƒãƒƒã‚·ãƒ¥ã®ã‚­ãƒ¼)!?
             #     â‡’ session[:user_id]  sessonãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªã„
    user = User.find_by(email: params[:session][:email].downcase)
      # ãƒã‚¹ãƒˆæ§‹é€ ã®ãƒãƒƒã‚·ãƒ¥ã®å€¤ã‚’å–å¾—ã—ã¦ã„ã‚‹ã€å…¥åŠ›ã•ã‚ŒãŸemailã‚’å–å¾—ã€‘
      # ãƒãƒƒã‚·ãƒ¥ã®ä¸­ã«ãƒãƒƒã‚·ãƒ¥ãŒã‚ã‚‹â†“
      # { session: { email: "sample@email.com", password: "password" } }
      # Userï¾ƒï½°ï¾Œï¾žï¾™ã«ã€ãƒ­ã‚°ã‚¤ãƒ³ã§å…¥åŠ›ã•ã‚ŒãŸemailãŒã‚ã‚‹ã‹ç¢ºèª
    if user && user.authenticate(params[:session][:password]) # 6.2.2ã«è¨˜è¼‰ã•ã‚Œã¦ã‚‹
      # â“µãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä½•ã‚’å…¥åŠ›ã—ã¦ã‚‚åˆ¤å®šã¯false
      # â“¶æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå–å¾—ã§ããŸãŒã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯é–“é•ã£ã¦ã„ã‚‹å ´åˆã®åˆ¤å®šã¯false
      # â“·æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå–å¾—ã§ãã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚‚ä¸€è‡´ã—ãŸå ´åˆã®åˆ¤å®šã¯true
      
      # ãƒ­ã‚°ã‚¤ãƒ³å‡ºæ¥ã‚Œã°ã€sessionå¤‰æ•°(cookies)ã«user_idã‚’ä¿å­˜
      log_in user # session_helper ã«ã¦å®šç¾© ã€sessionã«ä¿å­˜ã•ã‚ŒãŸuser_idã‚’å–å¾—ã€‘(6.3.1å‚ç…§)
        # log_in(user) â‡’ ä¸Šè¨˜ã¯å¼•æ•°ã¨ã—ã¦æŒ‡å®šã™ã‚‹ç‚ºã®()ã‚’çœç•¥ã—ã¦è¨˜è¿°
        # userã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®idã‚’session(cookie) ã«ä¿å­˜
      
      redirect_to user
        # å¼•æ•°ã®user ã®()ã‚’çœç•¥
        # redirect_to user_url(@user) ðŸ‘†railsã§ã¯å·¦è¨˜ã®ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«å®Ÿè¡Œã—ãŸã„ã“ã¨ã‚’åˆ¤æ–­ã—ã¦ãã‚Œã¾ã™
    else
      flash.now[:danger] = 'èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ'
        # flashå¤‰æ•°ã®ã¿ã ã¨ã€ï¾˜ï¾€ï¾žï½²ï¾šï½¸ï¾„ã—ã¦ã„ãªã„ç‚ºã€ï¾Œï¾—ï½¯ï½¼ï½­ï¾’ï½¯ï½¾ï½°ï½¼ï¾žãŒãšã£ã¨è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã€‚
        # â‡’ ãã‚Œã‚’é˜²ãç‚ºã€flash.now ã«ã—ã¦ã„ã‚‹ (6.2.3 å‚ç…§)
      render :new
    end
  end

  def destroy
    log_out
    flash[:success] = 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚'
    redirect_to root_url
  end
end